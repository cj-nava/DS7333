---
title: "unit10_boston-housing"
author: "Martin Garcia, Michael Catalano, Jeremy Otsap, Christian Nava"
date: "7/8/2020"
output: 
  html_document:
    keep_md: true

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(VIM)
library(skimr)
library(na.tools)

```

## Boston Data Set 

Using the Boston Housing Data Set examine the effect on loss for data Missing Completely at Random for 10% 20% and 50% of the data. Repeat the analysis for Missing at random and Missing Not at random. 


MCAR
MAR
Monotone


**https://www.kaggle.com/puxama/bostoncsv** 
https://www.kaggle.com/c/boston-housing
https://www.cs.toronto.edu/~delve/data/boston/bostonDetail.html


##Initial Data Exploration

**Data Description**

The Boston data frame has 506 rows and 14 columns.

This data frame contains the following columns:
  
* CRIM - per capita crime rate by town
* ZN - proportion of residential land zoned for lots over 25,000 sq.ft.
* INDUS - proportion of non-retail business acres per town.
* CHAS - Charles River dummy variable (1 if tract bounds river; 0 otherwise)
* NOX - nitric oxides concentration (parts per 10 million)
* RM - average number of rooms per dwelling
* AGE - proportion of owner-occupied units built prior to 1940
* DIS - weighted distances to five Boston employment centres
* RAD - index of accessibility to radial highways
* TAX - full-value property-tax rate per $10,000
* PTRATIO - pupil-teacher ratio by town
* B - 1000(Bk - 0.63)^2 where Bk is the proportion of blacks by town
* LSTAT - % lower status of the population
* MEDV - Median value of owner-occupied homes in $1000's


**Importing Data**

```{r, echo=FALSE}

# loading data set

boston.df <- read.csv("https://raw.githubusercontent.com/jotsap/DS7333/master/data/boston.csv", header = T)

```



**Cursory Data Exploration**

```{r, echo=FALSE}

#explore data frame

str(boston.df)
head(boston.df)
summary(boston.df)


```


Skim allows a quick visual examination of each variable's range

```{r, echo=FALSE}

#skim dataframe
skim(boston.df)


```




**Data Visualization**


```{r, echo=FALSE}

# loop through all parameters as histogram

bostonlength <- length(boston.df)
#i <- 1

for (i in 1:bostonlength) {
  # hist(boston.df[,i])
  print( boxplot(boston.df[,i])$out )
  i = i + 1
}


```






**Missing Data**

No missing values found

```{r, echo=FALSE}


# from VIM package
aggr(boston.df, 
     prop = FALSE, 
     combined = TRUE, 
     numbers = TRUE, 
     sortVars = TRUE, 
     sortCombs = TRUE)


```



##Initial Regression Model

We are doing a regression on full data set, predicting MEDV, the median value of owner-occupied homes, using the other 13 parameters.


**Exclude vs Omit**

Using na.exclude pads the residuals and fitted values with NAs where there were missing values. Other functions do not use the na.action, but instead have a different argument (with some default) for how they will handle missing values. For example, the mean command will, by default, return NA if there are any NAs in the passed object.


```{r, echo=FALSE}

# initial full regression

boston.lm <- lm( MEDV ~ . , data = boston.df, na.action = na.omit  )

# model results for goodniess of fit using adj r-sqr
summary(boston.lm)

# sse for loss
print("SSE for model is: ")
sum(boston.lm$residuals ^ 2)

# mse for loss
print("MSE for model is: ")
mean(boston.lm$residuals ^ 2)




```


**RESULTS**

For "goodness of fit" we ;ppl at the adjusted R-squared value [which penalizes for large numbers of predictors, and get a score of 0.7338. Which means roughly 73.4% of the MEDV response variable is accounted for by the other 13 predictors.

The Sum of Squares Error [SSE] for model is: 11078.78

The Mean Square Error [MSE] for model is: 21.89483

NOTE: Because AGE and INDUS were found to not be statistically significant we will *not* use those for the missing data exercises









##MCAR


First generate vector of *unique* random numbers to correspond to each percentage

* 1% - 5 entries
* 5% - 25 entries
* 10% - 51 entries
* 20% - 102 entries
* 33% - 168 entries
* 50% - 253 entries 


**Value to be Deleted**
* PTRATIO - pupil-teacher ratio by town



Create vector to serve as sample index for creating NA values


```{r, echo=FALSE}

# replace set to FALSE ensures no repeating numbers in sample vector

# 1% - 5 entries
base::sample(1:506, 5, replace = F) -> index_01

# 5% - 25 entires
base::sample(1:506, 25, replace = F) -> index_05

# 10% - 50 entires
base::sample(1:506, 51, replace = F) -> index_10

# 20% - 100 entries
base::sample(1:506, 102, replace = F) -> index_20

# 33% - 165 entries
base::sample(1:506, 168, replace = F) -> index_33

# 50% - 250 entries 
base::sample(1:506, 253, replace = F) -> index_50

```



**Create different boston samples with NA for PTRATIO**


1% - 5 entries 

```{r, echo=FALSE}

# create separate file
boston.df -> boston_mcar_01.df
# assign NA to PTRATIO
boston_mcar_01.df[index_01,'PTRATIO'] <- NA
# validate results

head(boston_mcar_01.df[index_01,'PTRATIO'])

aggr(boston_mcar_01.df, 
     prop = FALSE, 
     combined = TRUE, 
     numbers = TRUE, 
     sortVars = TRUE, 
     sortCombs = TRUE)

```



5% - 25 entries

```{r, echo=FALSE}

# create separate file
boston.df -> boston_mcar_05.df
# assign NA to PTRATIO
boston_mcar_05.df[index_05,'PTRATIO'] <- NA
# validate results

head(boston_mcar_05.df[index_05,'PTRATIO'])

aggr(boston_mcar_05.df, 
     prop = FALSE, 
     combined = TRUE, 
     numbers = TRUE, 
     sortVars = TRUE, 
     sortCombs = TRUE)

```


10% - 51 entries

```{r, echo=FALSE}

# create separate file
boston.df -> boston_mcar_10.df
# assign NA to PTRATIO
boston_mcar_10.df[index_10,'PTRATIO'] <- NA
# validate results

head(boston_mcar_10.df[index_10,'PTRATIO'])

aggr(boston_mcar_10.df, 
     prop = FALSE, 
     combined = TRUE, 
     numbers = TRUE, 
     sortVars = TRUE, 
     sortCombs = TRUE)

```


20% - 102 entries

```{r, echo=FALSE}

# create separate file
boston.df -> boston_mcar_20.df
# assign NA to PTRATIO
boston_mcar_20.df[index_20,'PTRATIO'] <- NA
# validate results

head(boston_mcar_20.df[index_20,'PTRATIO'])

aggr(boston_mcar_20.df, 
     prop = FALSE, 
     combined = TRUE, 
     numbers = TRUE, 
     sortVars = TRUE, 
     sortCombs = TRUE)

```


33% - 168 entries

```{r, echo=FALSE}

# create separate file
boston.df -> boston_mcar_33.df
# assign NA to PTRATIO
boston_mcar_33.df[index_33,'PTRATIO'] <- NA
# validate results

head(boston_mcar_33.df[index_33,'PTRATIO'])

aggr(boston_mcar_33.df, 
     prop = FALSE, 
     combined = TRUE, 
     numbers = TRUE, 
     sortVars = TRUE, 
     sortCombs = TRUE)

```


50% - 253 entries

```{r, echo=FALSE}

# create separate file
boston.df -> boston_mcar_50.df
# assign NA to PTRATIO
boston_mcar_50.df[index_50,'PTRATIO'] <- NA
# validate results

head(boston_mcar_50.df[index_50,'PTRATIO'])

aggr(boston_mcar_50.df, 
     prop = FALSE, 
     combined = TRUE, 
     numbers = TRUE, 
     sortVars = TRUE, 
     sortCombs = TRUE)

```




###MCAR Regression: Pairwise Deletion Using Mean Substitution


**1% - 5 entries**

Adjusted R-squared:  0.7344
[1] "SSE for model is: "
[1] 11052.98
[1] "MSE for model is: "
[1] 21.84383


```{r, echo=FALSE}

# mean substitution
boston_mcar_01.df$PTRATIO <- na.mean(boston_mcar_01.df$PTRATIO)

# regression model
boston_mcar_01.lm <- lm( MEDV ~ . , data = boston_mcar_01.df )

# model results for goodniess of fit using adj r-sqr
summary(boston_mcar_01.lm)

# sse for loss
print("SSE for model is: ")
sum(boston_mcar_01.lm$residuals ^ 2)

# mse for loss
print("MSE for model is: ")
mean(boston_mcar_01.lm$residuals ^ 2)


```



**5% - 25 entries**

Adjusted R-squared:  0.7313

[1] "SSE for model is: "
[1] 11182.17
[1] "MSE for model is: "
[1] 22.09915

```{r, echo=FALSE}

# mean substitution
boston_mcar_05.df$PTRATIO <- na.mean(boston_mcar_05.df$PTRATIO)

# regression model
boston_mcar_05.lm <- lm( MEDV ~ . , data = boston_mcar_05.df )

# model results for goodniess of fit using adj r-sqr
summary(boston_mcar_05.lm)

# sse for loss
print("SSE for model is: ")
sum(boston_mcar_05.lm$residuals ^ 2)

# mse for loss
print("MSE for model is: ")
mean(boston_mcar_05.lm$residuals ^ 2)


```



**10% - 51 entries**

Adjusted R-squared:  0.7345 
[1] "SSE for model is: "
[1] 11049.58
[1] "MSE for model is: "
[1] 21.83712

```{r, echo=FALSE}

# mean substitution
boston_mcar_10.df$PTRATIO <- na.mean(boston_mcar_10.df$PTRATIO)

# regression model
boston_mcar_10.lm <- lm( MEDV ~ . , data = boston_mcar_10.df )

# model results for goodniess of fit using adj r-sqr
summary(boston_mcar_10.lm)

# sse for loss
print("SSE for model is: ")
sum(boston_mcar_10.lm$residuals ^ 2)

# mse for loss
print("MSE for model is: ")
mean(boston_mcar_10.lm$residuals ^ 2)


```



**20% - 102 entries**

Adjusted R-squared:  0.7231 
[1] "SSE for model is: "
[1] 11523.58
[1] "MSE for model is: "
[1] 22.77388

```{r, echo=FALSE}

# mean substitution
boston_mcar_20.df$PTRATIO <- na.mean(boston_mcar_20.df$PTRATIO)

# regression model
boston_mcar_20.lm <- lm( MEDV ~ . , data = boston_mcar_20.df )

# model results for goodniess of fit using adj r-sqr
summary(boston_mcar_20.lm)

# sse for loss
print("SSE for model is: ")
sum(boston_mcar_20.lm$residuals ^ 2)

# mse for loss
print("MSE for model is: ")
mean(boston_mcar_20.lm$residuals ^ 2) 


```



**33% - 168 entries**

Adjusted R-squared:  0.7205 
[1] "SSE for model is: "
[1] 11632.02
[1] "MSE for model is: "
[1] 22.98819

```{r, echo=FALSE}

# mean substitution
boston_mcar_33.df$PTRATIO <- na.mean(boston_mcar_33.df$PTRATIO)

# regression model
boston_mcar_33.lm <- lm( MEDV ~ . , data = boston_mcar_33.df )

# model results for goodniess of fit using adj r-sqr
summary(boston_mcar_33.lm)

# sse for loss
print("SSE for model is: ")
sum(boston_mcar_33.lm$residuals ^ 2)

# mse for loss
print("MSE for model is: ")
mean(boston_mcar_33.lm$residuals ^ 2) 


```



**50% - 253 entries** 

Adjusted R-squared:  0.7142 
[1] "SSE for model is: "
[1] 11894.22
[1] "MSE for model is: "
[1] 23.50637

```{r, echo=FALSE}

# mean substitution
boston_mcar_50.df$PTRATIO <- na.mean(boston_mcar_50.df$PTRATIO)

# regression model
boston_mcar_50.lm <- lm( MEDV ~ . , data = boston_mcar_50.df )

# model results for goodniess of fit using adj r-sqr
summary(boston_mcar_50.lm)

# sse for loss
print("SSE for model is: ")
sum(boston_mcar_50.lm$residuals ^ 2)

# mse for loss
print("MSE for model is: ")
mean(boston_mcar_50.lm$residuals ^ 2) 


```





##MAR


**Determining Parameter for Deletion**
AGE < 80 = 266 entries 

**Values to be Deleted**
* CRIM - per capita crime rate by town
* RAD - index of accessibility to radial highways




```{r, echo=FALSE}

# list rows with AGE < 80 
boston.df[boston.df$AGE < 80,c("CRIM","RAD")]



# create initial MAR index
rownames( boston.df[boston.df$AGE < 80,c("CRIM","RAD")] ) %>% as.numeric() -> index_mar

#create 10% MAR index
sample(index_mar, 50 ) -> index_mar_10

#create 20% MAR index
sample(index_mar, 100) -> index_mar_20

#create 30% MAR index
sample(index_mar, 150) -> index_mar_30


```


**Replacement**

```{r, echo=FALSE}

# create 10% MAR dataframe
boston.df -> boston_mar_10.df

# create 20% MAR dataframe
boston.df -> boston_mar_20.df

# create 30% MAR dataframe
boston.df -> boston_mar_30.df


#assign NA to CRIM for 10% MAR
boston_mar_10.df[index_mar_10, c("CRIM","RAD")] <- NA

#assign NA to CRIM for 20% MAR
boston_mar_20.df[index_mar_20, c("CRIM","RAD")] <- NA

#assign NA to CRIM for 30% MAR
boston_mar_30.df[index_mar_30, c("CRIM","RAD")] <- NA


```



###MAR 10%

When AGE < 80, 10% of the entries for CRIM and RAD will be replaced with the NA value


**Validation**

```{r, echo=FALSE}

### 10% MAR

# list rows with missing values
boston_mar_10.df[is.na(boston_mar_10.df$CRIM),c("CRIM","RAD","AGE")]

# list rows with AGE < 80 
boston_mar_10.df[boston_mar_10.df$AGE < 80, c("CRIM","RAD","AGE")]

```


**Regression Using Mean Substitution**

Adjusted R-squared:  0.7312 
[1] "SSE for model is: "
[1] 11188.48
[1] "MSE for model is: "
[1] 22.11163

```{r, echo=FALSE}

# mean substitution for CRIM
boston_mar_10.df$CRIM <- na.mean(boston_mar_10.df$CRIM)

#mean substitution for RAD
boston_mar_10.df$RAD <- na.mean(boston_mar_10.df$RAD)

# regression model
boston_mar_10.lm <- lm( MEDV ~ . , data = boston_mar_10.df )

# model results for goodniess of fit using adj r-sqr
summary(boston_mar_10.lm)

# sse for loss
print("SSE for model is: ")
sum(boston_mar_10.lm$residuals ^ 2)

# mse for loss
print("MSE for model is: ")
mean(boston_mar_10.lm$residuals ^ 2) 



```




###MAR 20%

When AGE < 80, 20% of the entries for CRIM and RAD will be replaced with the NA value


**Validation**

```{r, echo=FALSE}

### 20% MAR

# list rows with missing values
boston_mar_20.df[is.na(boston_mar_20.df$CRIM),c("CRIM","RAD","AGE")]

# list rows with AGE < 80 
boston_mar_20.df[boston_mar_20.df$AGE < 80, c("CRIM","RAD","AGE")]

```


**Regression Using Mean Substitution**

Adjusted R-squared:  0.7292 
[1] "SSE for model is: "
[1] 11267.98
[1] "MSE for model is: "
[1] 22.26873

```{r, echo=FALSE}

# mean substitution for CRIM
boston_mar_20.df$CRIM <- na.mean(boston_mar_20.df$CRIM)

#mean substitution for RAD
boston_mar_20.df$RAD <- na.mean(boston_mar_20.df$RAD)

# regression model
boston_mar_20.lm <- lm( MEDV ~ . , data = boston_mar_20.df )

# model results for goodniess of fit using adj r-sqr
summary(boston_mar_20.lm)

# sse for loss
print("SSE for model is: ")
sum(boston_mar_20.lm$residuals ^ 2)

# mse for loss
print("MSE for model is: ")
mean(boston_mar_20.lm$residuals ^ 2) 



```




###MAR 30%

When AGE < 80, 30% of the entries for CRIM and RAD will be replaced with the NA value


**Validation**

```{r, echo=FALSE}

### 30% MAR

# list rows with missing values
boston_mar_30.df[is.na(boston_mar_30.df$CRIM),c("CRIM","RAD","AGE")]

# list rows with AGE < 80 
boston_mar_30.df[boston_mar_30.df$AGE < 80, c("CRIM","RAD","AGE")]

```


**Regression Using Mean Substitution**

Adjusted R-squared:  0.7325 
[1] "SSE for model is: "
[1] 11133.25
[1] "MSE for model is: "
[1] 22.00247

```{r, echo=FALSE}

# mean substitution for CRIM
boston_mar_30.df$CRIM <- na.mean(boston_mar_30.df$CRIM)

#mean substitution for RAD
boston_mar_30.df$RAD <- na.mean(boston_mar_30.df$RAD)

# regression model
boston_mar_30.lm <- lm( MEDV ~ . , data = boston_mar_30.df )

# model results for goodniess of fit using adj r-sqr
summary(boston_mar_30.lm)

# sse for loss
print("SSE for model is: ")
sum(boston_mar_30.lm$residuals ^ 2)

# mse for loss
print("MSE for model is: ")
mean(boston_mar_30.lm$residuals ^ 2) 



```





##MNAR

When TAX <= 279 entries will be replaced with the NA value

* TAX <= 279 [128 values 25.3%]





```{r, echo=FALSE}

# create 10% MAR dataframe
boston.df -> boston_mnar_25.df

# list rows with TAX <= 279 
boston_mnar_25.df[boston_mnar_25.df$TAX <= 279,]


```


**Replacement**



```{r, echo=FALSE}

#assign NA to TAX <= 279 for 25% MNAR
#boston_mnar_25.df[boston_mnar_25.df$TAX <= 279, ] <- NA

boston_mnar_25.df$TAX <- ifelse(boston_mnar_25.df$TAX <= 279, NA, boston_mnar_25.df$TAX) 


```

Validation

```{r, echo=FALSE}

aggr(boston_mnar_25.df, 
     prop = FALSE, 
     combined = TRUE, 
     numbers = TRUE, 
     sortVars = TRUE, 
     sortCombs = TRUE)



```


**Regression Using Mean Substitution**

Adjusted R-squared:  0.7292 
[1] "SSE for model is: "
[1] 11269.16
[1] "MSE for model is: "
[1] 22.27106

```{r, echo=FALSE}

# mean substitution for TAX
boston_mnar_25.df$TAX <- na.mean(boston_mnar_25.df$TAX)

# regression model
boston_mnar_25.lm <- lm( MEDV ~ . , data = boston_mnar_25.df )

# model results for goodniess of fit using adj r-sqr
summary(boston_mnar_25.lm)

# sse for loss
print("SSE for model is: ")
sum(boston_mnar_25.lm$residuals ^ 2)

# mse for loss
print("MSE for model is: ")
mean(boston_mnar_25.lm$residuals ^ 2) 



```








```{r, echo=FALSE}

# 


```



